<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helios - Terms and Conditions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #E8C547 0%, #D4A946 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .login-button-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 15px;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .login-button-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .login-btn {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%) !important;
            color: white !important;
            padding: 12px 24px !important;
            border: 2px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            font-weight: 600 !important;
            font-size: 14px !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4) !important;
            position: relative !important;
            overflow: hidden !important;
            flex: unset !important;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: #333;
        }

        .modal h2 {
            color: #333;
            margin-bottom: 20px;
            margin-top: 0;
            font-size: 24px;
        }

        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #DAA520;
            border-bottom-color: #DAA520;
        }

        .tab-button:hover {
            color: #DAA520;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .modal label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .modal input[type="email"],
        .modal input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .modal input[type="email"]:focus,
        .modal input[type="password"]:focus {
            outline: none;
            border-color: #DAA520;
            box-shadow: 0 0 5px rgba(218, 165, 32, 0.3);
        }

        .modal button[type="submit"] {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #E8C547 0%, #D4A946 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .modal button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(232, 197, 71, 0.4);
        }

        .modal button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .modal-message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            display: none;
            font-weight: 500;
        }

        .modal-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .modal-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .modal-message.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .approval-status {
            background-color: #f0f4ff;
            border-left: 4px solid #DAA520;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }

        .approval-status.show {
            display: block;
        }

        .approval-status h3 {
            color: #DAA520;
            margin-bottom: 10px;
        }

        .approval-status p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .approval-status p:last-child {
            margin-bottom: 0;
        }

        .status-approved {
            color: #155724;
            font-weight: 600;
        }

        .status-pending {
            color: #856404;
            font-weight: 600;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #E8C547 0%, #D4A946 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
            max-height: 600px;
            overflow-y: auto;
        }

        .content::-webkit-scrollbar {
            width: 8px;
        }

        .content::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .content::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        h2 {
            color: #DAA520;
            font-size: 20px;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid #DAA520;
            padding-bottom: 10px;
        }

        h2:first-child {
            margin-top: 0;
        }

        h3 {
            color: #333;
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 14px;
        }

        ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            color: #555;
            line-height: 1.8;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .principle {
            background-color: #f9f9f9;
            border-left: 4px solid #E8C547;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 3px;
        }

        .principle strong {
            color: #E8C547;
        }

        .footer-section {
            background-color: #f5f5f5;
            padding: 40px;
            border-top: 1px solid #e0e0e0;
        }

        .checkbox-group {
            margin-bottom: 20px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #DAA520;
        }

        .checkbox-item label {
            color: #333;
            cursor: pointer;
            font-size: 15px;
            user-select: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-accept {
            background: linear-gradient(135deg, #E8C547 0%, #D4A946 100%);
            color: white;
        }

        .btn-accept:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(232, 197, 71, 0.4);
        }

        .btn-accept:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-decline {
            background: #e0e0e0;
            color: #333;
        }

        .btn-decline:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 5px;
            text-align: center;
            display: none;
            font-weight: 500;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            margin-top: 10px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #DAA520;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .scroll-reminder {
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            color: #1976d2;
            font-size: 13px;
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 20px;
                max-height: 500px;
            }

            .footer-section {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Terms and Conditions</h1>
            <p>Helios</p>
        </div>

        <div class="content" id="contentScroll">
            <div class="scroll-reminder">Please scroll down to read all terms and conditions</div>

            <h2>1. Introduction</h2>
            <p>Welcome to Helios. This document outlines the terms and conditions, as well as our privacy policy in accordance with the Australian Privacy Principles (APPs), that govern your use of our student sign-up system.</p>

            <h2>2. Australian Privacy Principles (APPs) - Data Storage</h2>
            <p>We comply with the Australian Privacy Principles as set out in the Privacy Act 1988 (Cth). In accordance with the APPs, we ensure that:</p>

            <div class="principle">
                <strong>Data Collection & Storage:</strong> We collect and securely store only the personal information necessary for student registration and admission purposes. Your data will be stored safely and protected against unauthorized access.
            </div>

            <div class="principle">
                <strong>Data Security:</strong> We implement appropriate security measures to protect your personal information from unauthorized access, disclosure, alteration, and destruction, including secure server connections and regular security reviews.
            </div>

            <div class="principle">
                <strong>Data Retention:</strong> Your personal information will be retained for the duration of your enrolment plus 7 years as required by law, after which it will be securely destroyed.
            </div>

            <div class="principle">
                <strong>Your Privacy Rights:</strong> You have the right to access your personal information, request corrections, and lodge complaints regarding our privacy practices. Contact our Student Services for any privacy inquiries.
            </div>

            <h2>3. Terms and Conditions</h2>
            
            <h3>Use of Services</h3>
            <p>By using this sign-up system, you agree to provide accurate and truthful information. Any false or misleading information may result in your application being rejected or your enrolment being cancelled.</p>

            <h3>Eligibility</h3>
            <p>This application is open to all eligible applicants. By submitting this application, you confirm that you meet all eligibility criteria for enrolment at Helios and provide accurate information about yourself.</p>

            <h3>Application Process</h3>
            <p>Your application will be reviewed by our admissions team. We reserve the right to accept or reject applications at our discretion. You will be notified of the outcome via email.</p>

            <h3>Communication</h3>
            <p>You agree to receive communications from Helios regarding your application and enrolment. Please ensure your email address is correct and accessible.</p>

            <h3>Intellectual Property</h3>
            <p>All content and materials on this website are the property of Helios and are protected by copyright laws. You may not reproduce, distribute, or transmit any content without our written permission.</p>

            <h3>Limitation of Liability</h3>
            <p>Helios is not liable for any indirect, incidental, special, consequential, or punitive damages arising from your use of this system or your application.</p>

            <h3>Modification of Terms</h3>
            <p>We reserve the right to modify these terms and conditions at any time. Changes will be effective immediately. Your continued use of this system constitutes acceptance of the updated terms.</p>
        </div>

        <div class="footer-section">
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="agreeCheckbox">
                    <label for="agreeCheckbox">I agree to the Terms and Conditions and Australian Privacy Principles</label>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-accept" id="acceptBtn" onclick="acceptTerms()" disabled>Accept and Continue</button>
                <button class="btn-decline" onclick="declineTerms()">Decline</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
            </div>

            <div class="message" id="message"></div>
        </div>
    </div>

    <script>
        // Enable accept button only when checkbox is checked
        document.getElementById('agreeCheckbox').addEventListener('change', function() {
            document.getElementById('acceptBtn').disabled = !this.checked;
        });

        // Scroll detection to require reading full document
        const contentScroll = document.getElementById('contentScroll');
        const acceptBtn = document.getElementById('acceptBtn');
        let hasScrolledToBottom = false;

        contentScroll.addEventListener('scroll', function() {
            const isAtBottom = contentScroll.scrollHeight - contentScroll.scrollTop <= contentScroll.clientHeight + 10;
            if (isAtBottom && !hasScrolledToBottom) {
                hasScrolledToBottom = true;
            }
        });

        async function acceptTerms() {
            if (!document.getElementById('agreeCheckbox').checked) {
                showMessage('Please check the agreement box', 'error');
                return;
            }

            const loading = document.getElementById('loading');
            const message = document.getElementById('message');
            const acceptBtn = document.getElementById('acceptBtn');

            message.classList.remove('error');
            message.textContent = '';
            loading.style.display = 'block';
            acceptBtn.disabled = true;

            try {
                const response = await fetch('/accept-terms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ accepted: true })
                });

                const result = await response.json();
                loading.style.display = 'none';

                if (response.ok) {
                    // Redirect to email verification
                    setTimeout(() => {
                        window.location.href = result.redirect;
                    }, 500);
                } else {
                    showMessage(result.message || 'Failed to accept terms', 'error');
                    acceptBtn.disabled = !document.getElementById('agreeCheckbox').checked;
                }
            } catch (error) {
                loading.style.display = 'none';
                showMessage('An error occurred. Please try again.', 'error');
                acceptBtn.disabled = !document.getElementById('agreeCheckbox').checked;
                console.error('Error:', error);
            }
        }

        function declineTerms() {
            if (confirm('You must accept the terms and conditions to continue. Are you sure you want to decline?')) {
                window.location.href = '/';
            }
        }

        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = 'message ' + type;
        }

        // Keyboard support
        document.getElementById('agreeCheckbox').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                acceptTerms();
            }
        });
    </script>

    <!-- Navigation Buttons -->
    <div class="login-button-container">
        <button class="login-btn" onclick="window.location.href='/terms'">Sign Up</button>
        <button class="login-btn" onclick="window.open('https://archive.example.com', '_blank')">View Archive</button>
        <button class="login-btn" onclick="openLoginModal()">Check Status</button>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeLoginModal()">&times;</button>
            
            <h2>Login</h2>
            
            <div class="login-tabs">
                <button class="tab-button active" onclick="switchTab('check-approval')">Check Approval</button>
                <button class="tab-button" onclick="switchTab('change-password')">Change Password</button>
            </div>

            <!-- Check Approval Tab -->
            <div id="check-approval" class="tab-content active">
                <form id="approvalForm" onsubmit="checkApproval(event)">
                    <div class="form-group">
                        <label for="approvalEmail">Email Address</label>
                        <input type="email" id="approvalEmail" name="email" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="approvalPassword">Password</label>
                        <input type="password" id="approvalPassword" name="password" required placeholder="Enter your password">
                    </div>
                    <button type="submit">Check Status</button>
                    <div id="approvalMessage" class="modal-message"></div>
                    <div id="approvalStatus" class="approval-status"></div>
                </form>
            </div>

            <!-- Change Password Tab -->
            <div id="change-password" class="tab-content">
                <form id="passwordChangeForm" onsubmit="requestPasswordChange(event)">
                    <div class="form-group">
                        <label for="changeEmail">Email Address</label>
                        <input type="email" id="changeEmail" name="email" required placeholder="Enter your email">
                    </div>
                    <button type="submit">Request Password Change</button>
                    <div id="passwordChangeMessage" class="modal-message"></div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('show');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
            // Reset forms
            document.getElementById('approvalForm').reset();
            document.getElementById('passwordChangeForm').reset();
            document.getElementById('approvalMessage').textContent = '';
            document.getElementById('approvalMessage').className = 'modal-message';
            document.getElementById('passwordChangeMessage').textContent = '';
            document.getElementById('passwordChangeMessage').className = 'modal-message';
            document.getElementById('approvalStatus').className = 'approval-status';
        }

        // Scroll fade effect for buttons
        window.addEventListener('scroll', function() {
            const container = document.querySelector('.login-button-container');
            const scrollTop = window.scrollY || document.documentElement.scrollTop;
            
            if (scrollTop > 300) {
                container.classList.add('hidden');
            } else {
                container.classList.remove('hidden');
            }
        });

        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Deactivate all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function checkApproval(e) {
            e.preventDefault();
            
            const email = document.getElementById('approvalEmail').value.trim();
            const password = document.getElementById('approvalPassword').value;
            const messageDiv = document.getElementById('approvalMessage');
            const statusDiv = document.getElementById('approvalStatus');
            
            messageDiv.textContent = 'Checking status...';
            messageDiv.className = 'modal-message info';
            statusDiv.className = 'approval-status';
            
            try {
                const response = await fetch('/api/check-approval', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    if (result.approved) {
                        messageDiv.textContent = result.message;
                        messageDiv.className = 'modal-message success';
                        statusDiv.innerHTML = `
                            <h3>âœ“ Application Approved!</h3>
                            <p><span class="status-approved">Your application has been approved!</span></p>
                            <p><strong>Name:</strong> ${result.user.name}</p>
                            <p><strong>Email:</strong> ${result.user.email}</p>
                            <p>You can now access the Helios system with your credentials.</p>
                        `;
                        statusDiv.classList.add('show');
                    } else {
                        messageDiv.textContent = result.message;
                        messageDiv.className = 'modal-message info';
                        statusDiv.innerHTML = `
                            <h3>Application Under Review</h3>
                            <p><span class="status-pending">Status: ${result.status.charAt(0).toUpperCase() + result.status.slice(1)}</span></p>
                            <p>Your application is still being reviewed. We will notify you via email once a decision has been made.</p>
                            <p>Please check your email regularly for updates.</p>
                        `;
                        statusDiv.classList.add('show');
                    }
                } else {
                    messageDiv.textContent = result.message || 'Invalid credentials';
                    messageDiv.className = 'modal-message error';
                }
            } catch (error) {
                messageDiv.textContent = 'Error checking status. Please try again.';
                messageDiv.className = 'modal-message error';
                console.error('Error:', error);
            }
        }

        async function requestPasswordChange(e) {
            e.preventDefault();
            
            const email = document.getElementById('changeEmail').value.trim();
            const messageDiv = document.getElementById('passwordChangeMessage');
            
            messageDiv.textContent = 'Sending request...';
            messageDiv.className = 'modal-message info';
            
            try {
                const response = await fetch('/api/request-password-change', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    messageDiv.textContent = result.message;
                    messageDiv.className = 'modal-message success';
                    document.getElementById('passwordChangeForm').reset();
                    setTimeout(() => {
                        closeLoginModal();
                    }, 2000);
                } else {
                    messageDiv.textContent = result.message || 'Error sending request';
                    messageDiv.className = 'modal-message error';
                }
            } catch (error) {
                messageDiv.textContent = 'Error sending request. Please try again.';
                messageDiv.className = 'modal-message error';
                console.error('Error:', error);
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('loginModal');
            if (event.target === modal) {
                closeLoginModal();
            }
        }
    </script>
</body>
</html>
